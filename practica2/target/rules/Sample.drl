package com.sample
 
import com.sample.DroolsTest.Message;
import com.sample.DroolsTest.Node;
import com.sample.DroolsTest.Edge;
import com.sample.DroolsTest.Path;
 
rule "Hello World"
    when
        m : Message( status == Message.HELLO, myMessage : message )
    then
        System.out.println( myMessage );
        m.setMessage( "Goodbye cruel world" );
        m.setStatus( Message.GOODBYE );
        update( m );
end

rule "GoodBye"
    when
        Message( status == Message.GOODBYE, myMessage : message )
    then
        System.out.println( myMessage );
end

rule "Path Direct" salience 10
	when
		$ini : Node()
		$fin : Node()
		$e : Edge(initialNode == $ini, finalNode == $fin)
		p : Path(ini == $ini, fin == $fin)
		
	then
		$ini.setStatus(Node.VISITED);
		$fin.setStatus(Node.VISITED);
		p.getPath().add($e);
		System.out.println("INI: " + $e.getInitialNode().getValue() + " ; FIN: " + $e.getFinalNode().getValue());	
end

rule "Path Indirect" salience 10
	when
		$ini : Node(status == Node.NOT_VISITED)
		$inter : Node(status == Node.NOT_VISITED)
		$fin : Node(status == Node.NOT_VISITED)
		$e : Edge(initialNode == $ini, finalNode == $inter)
		$p1 : Path(ini == $inter, fin == $fin)
	then
		$ini.setStatus(Node.VISITED);
		$inter.setStatus(Node.VISITED);

		System.out.println("PATH INDIRECT INI: " + $e.getInitialNode().getValue() + " ; FIN: " + $e.getFinalNode().getValue());	
		
		
end

